ğŸš€ Updated Prompt for Replit Staging Agent
ğŸš¨ Do NOT install TinaCMS in staging. Only fix MDX handling and sync content from static.

âœ… 1. Fix Directory Structure
1ï¸âƒ£ Delete any duplicate static/ folder inside staging.

The staging branch should read MDX from static/content/.
If the agent added a staging/static/ folder, DELETE IT.
Do NOT store MDX inside staging. TinaCMS manages that in static.
âœ… Final Correct Structure (staging)

java
Copy
Edit
ğŸ“‚ staging (branch)
 â”£ ğŸ“‚ pages
 â”£ ğŸ“‚ components
 â”£ ğŸ“‚ public
 â”£ ğŸ“‚ static (GitHub `static` branch reference)
 â”ƒ â”£ ğŸ“‚ content
 â”ƒ â”ƒ â”£ ğŸ“‚ pages
 â”ƒ â”ƒ â”£ ğŸ“‚ posts
 â”£ ğŸ“œ package.json
 â”£ ğŸ“œ next.config.js
 â”£ ğŸ“œ README.md
ğŸš¨ Do NOT install TinaCMS here. staging should only read MDX from static.

âœ… 2. Fix Next.js to Load MDX from static/content/
2ï¸âƒ£ Update Next.js dynamic routes (pages/[slug].tsx) to fetch MDX from static/content/.

tsx
Copy
Edit
import fs from "fs";
import path from "path";
import matter from "gray-matter";
import { serialize } from "next-mdx-remote/serialize";
import { MDXRemote } from "next-mdx-remote";
import remarkGfm from "remark-gfm";

export default function Page({ source, frontMatter }) {
  return (
    <div>
      <h1>{frontMatter.title}</h1>
      <MDXRemote {...source} />
    </div>
  );
}

// âœ… Load MDX from `static/content/pages/`
export async function getStaticProps({ params }) {
  const mdxPath = path.join("..", "static", "content", "pages", `${params.slug}.mdx`);
  const fileContents = fs.readFileSync(mdxPath, "utf8");
  const { content, data } = matter(fileContents);

  const mdxSource = await serialize(content, { mdxOptions: { remarkPlugins: [remarkGfm] } });

  return {
    props: {
      source: mdxSource,
      frontMatter: data,
    },
  };
}

// âœ… Generate dynamic paths from `static/content/pages/`
export async function getStaticPaths() {
  const dirPath = path.join("..", "static", "content", "pages");
  const filenames = fs.readdirSync(dirPath);
  const paths = filenames.map((file) => ({
    params: { slug: file.replace(".mdx", "") },
  }));

  return {
    paths,
    fallback: false,
  };
}
âœ… 3. Sync static Content Before Each Build
3ï¸âƒ£ Ensure staging always pulls the latest MDX content from static before running npm run build.

âœ… Add this command to Replit's build process:

bash
Copy
Edit
# Ensure you're on `staging` branch
git checkout staging

# Pull latest MDX content from `static`
git fetch origin static
git checkout static
git pull origin static

# Switch back to `staging`
git checkout staging

# Run Next.js build
npm run build
ğŸš¨ This ensures every build includes the latest MDX changes from static.

ğŸš€ Final Steps
âœ” Delete any extra static/ folder inside staging.
âœ” Ensure staging reads MDX from static/content/.
âœ” Sync static content before every build.
âœ” Test: Edit content in TinaCMS (main), then check if staging builds the new content.

